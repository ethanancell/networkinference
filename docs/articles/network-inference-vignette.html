<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Getting started with the networkinference R package • networkinference</title>
<script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet">
<script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with the networkinference R package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">networkinference</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/network-inference-vignette.html">Getting Started</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ethanancell/networkinference">GitHub</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ethanancell/networkinference">GitHub</a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Getting started with the networkinference R package</h1>
            
      

      <div class="d-none name"><code>network-inference-vignette.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="necessary-packages-for-this-vignette">Necessary packages for this vignette<a class="anchor" aria-label="anchor" href="#necessary-packages-for-this-vignette"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ethanancell.github.io/networkinference/">networkinference</a></span><span class="op">)</span> <span class="co"># Package implementing the methods of this paper</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/aaamini/nett" class="external-link">nett</a></span><span class="op">)</span> <span class="co"># For spectral clustering</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yixuan/RSpectra" class="external-link">RSpectra</a></span><span class="op">)</span> <span class="co"># Dependency of nett package</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span> <span class="co"># Reproducibility</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="networks-with-gaussian-edges">Networks with Gaussian edges<a class="anchor" aria-label="anchor" href="#networks-with-gaussian-edges"></a>
</h3>
<p>Suppose we observe a network <span class="math inline">n = 60</span>
nodes. In the Gaussian setting, the edges encoded in the adjacency
matrix obey <span class="math inline">A_{ij} \overset{\text{ind.}}{\sim}
N(M_{ij}, \tau^2)</span>, where we treat <span class="math inline">M_{ij}</span> as unknown and <span class="math inline">\tau^2</span> as known. Let us simulate an adjacency
matrix from a setting where there are three “true communities,” where
the intra-community connectivity is <span class="math inline">\rho_1 =
25</span>, the inter-community connectivity is <span class="math inline">\rho_2 = 18</span>, and the known edge variance is
<span class="math inline">\tau^2 = 4^2</span>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Some global information</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">60</span></span>
<span><span class="va">n_per_community</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">tau</span> <span class="op">&lt;-</span> <span class="fl">4</span> <span class="co"># Known standard deviation of the edges</span></span>
<span><span class="va">rho_1</span> <span class="op">&lt;-</span> <span class="fl">25</span> <span class="co"># Intra-community connectivity</span></span>
<span><span class="va">rho_2</span> <span class="op">&lt;-</span> <span class="fl">18</span> <span class="co"># Inter-community connectivity</span></span>
<span></span>
<span><span class="co"># Build tiles which we will use to construct our mean matrix M</span></span>
<span><span class="va">intra_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">rho_1</span>, <span class="va">n_per_community</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n_per_community</span><span class="op">)</span></span>
<span><span class="va">inter_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">rho_2</span>, <span class="va">n_per_community</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n_per_community</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Construct mean matrix</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">intra_comm</span>, <span class="va">inter_comm</span>, <span class="va">inter_comm</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">inter_comm</span>, <span class="va">intra_comm</span>, <span class="va">inter_comm</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">inter_comm</span>, <span class="va">inter_comm</span>, <span class="va">intra_comm</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Draw a network using this mean matrix</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">^</span><span class="fl">2</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span>, sd <span class="op">=</span> <span class="va">tau</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<p>Visualizing the adjacency matrix with an image (rows run from top to
bottom, columns run from left to right), we can see that there are a
greater density of connections within communities than there are between
communities.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>pty <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">A</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="network-inference-vignette_files/figure-html/unnamed-chunk-3-1.png" width="384"></p>
<p>Now, let’s use the <code><a href="../reference/split_network.html">split_network()</a></code> function from the
package to split this adjacency matrix <span class="math inline">A</span> into our train and test adjacency matrices.
As arguments, we must provide our distributional setting (Gaussian), our
splitting parameter <span class="math inline">\epsilon = 0.5</span>, as
well as our known variance <span class="math inline">\tau^2 =
4^2</span>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gaussian_split_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/split_network.html">split_network</a></span><span class="op">(</span><span class="va">A</span>, distribution <span class="op">=</span> <span class="st">"gaussian"</span>, </span>
<span>                                        epsilon <span class="op">=</span> <span class="fl">0.5</span>, tau <span class="op">=</span> <span class="va">tau</span><span class="op">)</span></span>
<span><span class="va">Atr</span> <span class="op">&lt;-</span> <span class="va">gaussian_split_results</span><span class="op">$</span><span class="va">Atr</span></span>
<span><span class="va">Ate</span> <span class="op">&lt;-</span> <span class="va">gaussian_split_results</span><span class="op">$</span><span class="va">Ate</span></span>
<span></span>
<span><span class="co"># Visualize both the Atr and Ate matrices</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Atr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Atr</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Train network"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Ate</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Ate</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Test network"</span><span class="op">)</span></span></code></pre></div>
<p><img src="network-inference-vignette_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
<p>Now, let us conduct community estimation using <code>Atr</code> using
<span class="math inline">K=4</span> communities. (Note that this is a
misspecified number of communities!)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimated_communities</span> <span class="op">&lt;-</span> <span class="fu">nett</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nett/man/spec_clust.html" class="external-link">spec_clust</a></span><span class="op">(</span><span class="va">Atr</span>, K <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">estimated_communities</span> <span class="co"># A vector specifying each node's estimated community</span></span>
<span><span class="co">#&gt;  [1] 2 2 2 2 2 4 4 4 4 2 2 2 2 2 2 4 2 4 2 4 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3</span></span>
<span><span class="co">#&gt; [39] 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span></span></code></pre></div>
<p>Let’s now try to conduct inference for the <strong>mean
intra-community connectivity within the 1st estimated
community.</strong> To do this, we will want to set an appropriate
linear combination vector <span class="math inline">u</span> which is of
length <span class="math inline">K^2</span>, where <span class="math inline">K</span> is the number of estimated communities.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">u_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, </span>
<span>              <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, </span>
<span>              <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>              <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Conduct inference for the selected target (mean connectivity within the</span></span>
<span><span class="co"># first estimated community)</span></span>
<span><span class="va">gaussian_inference</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/infer_network.html">infer_network</a></span><span class="op">(</span>Ate <span class="op">=</span> <span class="va">Ate</span>, u <span class="op">=</span> <span class="va">u_vector</span>,</span>
<span>                communities <span class="op">=</span> <span class="va">estimated_communities</span>,</span>
<span>                distribution <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                epsilon <span class="op">=</span> <span class="fl">0.5</span>, tau <span class="op">=</span> <span class="va">tau</span><span class="op">)</span></span></code></pre></div>
<p>The resulting <code>gaussian_inference</code> contains two pieces,
the estimate <code>gaussian_inference$estimate</code> (<span class="math inline">\hat{\theta}(A^{(\text{tr})})</span> in the
accompanying paper), as well as the estimate of the variance
<code>gaussian_inference$estimate_variance</code> (<span class="math inline">\hat{\sigma}^2</span> in the accompanying paper). In
this case, we find that</p>
<p><span class="math display">\hat{\theta}(A^{(\text{tr})}) = 24.1638,
\quad \hat{\sigma}^2 = 0.0726.</span></p>
<p>So, we can construct a 90% confidence interval for this target with
the following:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.10</span></span>
<span><span class="va">margin_of_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">gaussian_inference</span><span class="op">$</span><span class="va">estimate_variance</span><span class="op">)</span></span>
<span><span class="va">ci_lower_bound</span> <span class="op">&lt;-</span> <span class="va">gaussian_inference</span><span class="op">$</span><span class="va">estimate</span> <span class="op">-</span> <span class="va">margin_of_error</span></span>
<span><span class="va">ci_upper_bound</span> <span class="op">&lt;-</span> <span class="va">gaussian_inference</span><span class="op">$</span><span class="va">estimate</span> <span class="op">+</span> <span class="va">margin_of_error</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Estimate of selected target is "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">gaussian_inference</span><span class="op">$</span><span class="va">estimate</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Estimate of selected target is 24.1638"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Confidence interval for selected target is ["</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ci_lower_bound</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">", "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ci_upper_bound</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Confidence interval for selected target is [23.7207, 24.6068]"</span></span></code></pre></div>
<p>Because we simulated the data ourselves, we can check whether this
confidence interval actually contained the true target of inference.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">true_target</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_target_of_inference.html">check_target_of_inference</a></span><span class="op">(</span>M <span class="op">=</span> <span class="va">M</span>, u <span class="op">=</span> <span class="va">u_vector</span>,</span>
<span>                                         communities <span class="op">=</span> <span class="va">estimated_communities</span><span class="op">)</span></span>
<span><span class="va">true_target_contained</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">ci_lower_bound</span> <span class="op">&lt;=</span> <span class="va">true_target</span><span class="op">)</span> <span class="op">&amp;</span> </span>
<span>  <span class="op">(</span><span class="va">true_target</span> <span class="op">&lt;=</span> <span class="va">ci_upper_bound</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Print results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"True target of inference is "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">true_target</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "True target of inference is 24.3651"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">"Did the 90% confidence interval contain the true target of inference?"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Did the 90% confidence interval contain the true target of inference?"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"-&gt; "</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">true_target_contained</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "-&gt; TRUE"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="networks-with-bernoulli-edges">Networks with Bernoulli edges<a class="anchor" aria-label="anchor" href="#networks-with-bernoulli-edges"></a>
</h3>
<p>Once again, we consider a setting with <span class="math inline">n=60</span> nodes. In the Bernoulli setting, we
assume <span class="math inline">A_{ij} \overset{\text{ind.}}{\sim}
\text{Bernoulli}(M_{ij})</span>, where <span class="math inline">M_{ij}</span> is unknown. Let us simulate in a
setting where there are three “true communities,” where the
intra-community connectivity is <span class="math inline">\rho_1 =
0.80</span>, and the inter-community connectivity is <span class="math inline">\rho_2 = 0.40</span>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">60</span></span>
<span><span class="va">n_per_community</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">rho_1</span> <span class="op">&lt;-</span> <span class="fl">0.80</span></span>
<span><span class="va">rho_2</span> <span class="op">&lt;-</span> <span class="fl">0.40</span></span>
<span></span>
<span><span class="co"># Used to construct the mean matrix</span></span>
<span><span class="va">intra_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">rho_1</span>, <span class="va">n_per_community</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n_per_community</span><span class="op">)</span></span>
<span><span class="va">inter_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">rho_2</span>, <span class="va">n_per_community</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n_per_community</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Construct mean matrix</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">intra_comm</span>, <span class="va">inter_comm</span>, <span class="va">inter_comm</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">inter_comm</span>, <span class="va">intra_comm</span>, <span class="va">inter_comm</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">inter_comm</span>, <span class="va">inter_comm</span>, <span class="va">intra_comm</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Draw a network using this mean matrix</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">^</span><span class="fl">2</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<p>Visualizing the adjacency matrix with an image (rows run from top to
bottom, columns run from left to right), we can see that there are a
greater density of connections within communities than there are between
communities. In contrast to the Gaussian adjacency matrix from before,
the edge connections are unweighted (binary) rather than weighted
(continuous or integer-valued).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>pty <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">A</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="network-inference-vignette_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Now, we can use the <code><a href="../reference/split_network.html">split_network()</a></code> function from the
package to split this into our train and test adjacency matrices. To
split with a parameter <span class="math inline">\gamma = 0.15</span>,
we will pass in <code>gamma = 0.15</code> into the function, and specify
our distributional setting.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bernoulli_split_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/split_network.html">split_network</a></span><span class="op">(</span><span class="va">A</span>, distribution <span class="op">=</span> <span class="st">"bernoulli"</span>,</span>
<span>                                         gamma <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span></span>
<span><span class="va">Atr</span> <span class="op">&lt;-</span> <span class="va">bernoulli_split_results</span><span class="op">$</span><span class="va">Atr</span></span>
<span><span class="va">Ate</span> <span class="op">&lt;-</span> <span class="va">bernoulli_split_results</span><span class="op">$</span><span class="va">Ate</span></span>
<span></span>
<span><span class="co"># Visualize both the Atr and Ate matrices</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Atr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Atr</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Train network"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Ate</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Ate</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Test network"</span><span class="op">)</span></span></code></pre></div>
<p><img src="network-inference-vignette_files/figure-html/unnamed-chunk-11-1.png" width="576"></p>
<p>Now, let us conduct community estimation using <code>Atr</code> using
<span class="math inline">K=4</span> communities. (Note that this is a
misspecified number of communities!)</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">estimated_communities</span> <span class="op">&lt;-</span> <span class="fu">nett</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nett/man/spec_clust.html" class="external-link">spec_clust</a></span><span class="op">(</span><span class="va">Atr</span>, K <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="va">estimated_communities</span> <span class="co"># A vector specifying each node's estimated community</span></span>
<span><span class="co">#&gt;  [1] 1 3 4 1 3 1 2 1 1 1 4 1 3 1 1 3 4 3 1 2 1 3 3 1 1 3 3 3 3 1 1 3 1 3 3 1 4 1</span></span>
<span><span class="co">#&gt; [39] 2 1 3 3 4 4 3 4 4 2 2 4 3 2 4 2 4 1 4 4 4 4</span></span></code></pre></div>
<p>Let’s now try to conduct inference for the <strong>mean
intra-community connectivity within the 1st estimated
community.</strong> To do this, we will want to set an appropriate
linear combination vector <span class="math inline">u</span> which is of
length <span class="math inline">K^2</span>, where <span class="math inline">K</span> is the number of estimated communities.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">u_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, </span>
<span>              <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, </span>
<span>              <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>              <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Conduct inference for the selected target (mean connectivity within the</span></span>
<span><span class="co"># first estimated community)</span></span>
<span><span class="va">bernoulli_inference</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/infer_network.html">infer_network</a></span><span class="op">(</span>Ate <span class="op">=</span> <span class="va">Ate</span>, u <span class="op">=</span> <span class="va">u_vector</span>,</span>
<span>                communities <span class="op">=</span> <span class="va">estimated_communities</span>,</span>
<span>                distribution <span class="op">=</span> <span class="st">"bernoulli"</span>,</span>
<span>                Atr <span class="op">=</span> <span class="va">Atr</span>,</span>
<span>                gamma <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span></span></code></pre></div>
<p>The resulting object <code>bernoulli_inference</code> contains two
pieces, the estimate <code>bernoulli_inference$estimate</code> (<span class="math inline">\hat{\xi}(A^{(\text{tr})})</span> in the paper), as
well as the estimate of the variance
<code>bernoulli_inference$estimate_variance</code> (<span class="math inline">\hat{\sigma}^2</span> in the paper). In this case,
we find that</p>
<p><span class="math display">\hat{\xi}(A^{(\text{tr})}) = 0.522, \quad
\hat{\sigma}^2 = 0.0012.</span></p>
<p>Thus, we construct a 90% confidence interval with the following:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.10</span></span>
<span><span class="va">margin_of_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">bernoulli_inference</span><span class="op">$</span><span class="va">estimate_variance</span><span class="op">)</span></span>
<span><span class="va">ci_lower_bound</span> <span class="op">&lt;-</span> <span class="va">bernoulli_inference</span><span class="op">$</span><span class="va">estimate</span> <span class="op">-</span> <span class="va">margin_of_error</span></span>
<span><span class="va">ci_upper_bound</span> <span class="op">&lt;-</span> <span class="va">bernoulli_inference</span><span class="op">$</span><span class="va">estimate</span> <span class="op">+</span> <span class="va">margin_of_error</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Confidence interval for selected target is ["</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ci_lower_bound</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">", "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ci_upper_bound</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Confidence interval for selected target is [0.4648, 0.5793]"</span></span></code></pre></div>
<p>Because we simulated the data ourselves, we can check how this
matches up with the true targets of interest, both <span class="math inline">\theta(A^{(\text{tr})})</span> and <span class="math inline">\xi(A^{(\text{tr})})</span>. Please see the
accompanying paper for a reminder on the differences between these two
targets.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">true_target_theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_target_of_inference.html">check_target_of_inference</a></span><span class="op">(</span>M <span class="op">=</span> <span class="va">M</span>, u <span class="op">=</span> <span class="va">u_vector</span>,</span>
<span>                                               communities <span class="op">=</span> <span class="va">estimated_communities</span><span class="op">)</span></span>
<span><span class="va">true_target_xi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/check_target_of_inference.html">check_target_of_inference</a></span><span class="op">(</span>M <span class="op">=</span> <span class="va">M</span>, u <span class="op">=</span> <span class="va">u_vector</span>,</span>
<span>                                            communities <span class="op">=</span> <span class="va">estimated_communities</span>,</span>
<span>                                            bernoulli_target <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                            gamma <span class="op">=</span> <span class="fl">0.15</span>, Atr <span class="op">=</span> <span class="va">Atr</span><span class="op">)</span></span></code></pre></div>
<p>In this case, we find that</p>
<p><span class="math display">\theta(A^{(\text{tr})}) = 0.582, \quad
\xi(A^{(\text{tr})}) = 0.5742.</span></p>
</div>
<div class="section level3">
<h3 id="undirected-networks-and-networks-without-self-loops">Undirected networks and networks without self-loops<a class="anchor" aria-label="anchor" href="#undirected-networks-and-networks-without-self-loops"></a>
</h3>
<p>When working with undirected networks, an edge linking node <span class="math inline">i</span> to <span class="math inline">j</span> is
synonymous with an edge linking node <span class="math inline">j</span>
to <span class="math inline">i</span>. In the
<code>networkinference</code> package, only the upper triangular
portions of the adjacency matrices for undirected networks are used.
Crucially, the linear combination vector <span class="math inline">u</span> must also correspond to an upper triangular
matrix.</p>
<p>For networks that do not allow self-loops, all values along the
diagonal of the adjacency matrix <span class="math inline">A</span> are
ignored.</p>
<p>Here is a simple example involving an undirected Poisson network that
does not allow self-loops.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">60</span></span>
<span><span class="va">n_per_community</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">rho_1</span> <span class="op">&lt;-</span> <span class="fl">25</span> <span class="co"># Intra-community connectivity</span></span>
<span><span class="va">rho_2</span> <span class="op">&lt;-</span> <span class="fl">18</span> <span class="co"># Inter-community connectivity</span></span>
<span></span>
<span><span class="co"># Build tiles which we will use to construct our mean matrix M</span></span>
<span><span class="va">zeros_block</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_per_community</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n_per_community</span><span class="op">)</span></span>
<span><span class="va">intra_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n_per_community</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n_per_community</span><span class="op">)</span></span>
<span><span class="va">intra_comm</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">upper.tri</a></span><span class="op">(</span><span class="va">intra_comm</span>, diag <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">rho_1</span></span>
<span><span class="va">inter_comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">rho_2</span>, <span class="va">n_per_community</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n_per_community</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Construct mean matrix</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">intra_comm</span>, <span class="va">inter_comm</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">zeros_block</span>, <span class="va">intra_comm</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Draw a network using this mean matrix</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">n</span><span class="op">^</span><span class="fl">2</span>, lambda <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span></code></pre></div>
<p>Visualizing the adjacency matrix with an image (rows run from top to
bottom, columns run from left to right), we can see that there are a
greater density of connections within communities than there are between
communities.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>pty <span class="op">=</span> <span class="st">"s"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">A</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="network-inference-vignette_files/figure-html/unnamed-chunk-17-1.png" width="384"></p>
<p>Now, let’s use the <code><a href="../reference/split_network.html">split_network()</a></code> function from the
package to split this adjacency matrix <span class="math inline">A</span> into our train and test adjacency matrices.
As arguments, we must provide our distributional setting (Poisson), and
our splitting parameter <span class="math inline">\epsilon =
0.5</span>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">poisson_split_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/split_network.html">split_network</a></span><span class="op">(</span><span class="va">A</span>, distribution <span class="op">=</span> <span class="st">"poisson"</span>, </span>
<span>                                       epsilon <span class="op">=</span> <span class="fl">0.5</span>, is_directed <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                       allow_self_loops <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">Atr</span> <span class="op">&lt;-</span> <span class="va">poisson_split_results</span><span class="op">$</span><span class="va">Atr</span></span>
<span><span class="va">Ate</span> <span class="op">&lt;-</span> <span class="va">poisson_split_results</span><span class="op">$</span><span class="va">Ate</span></span>
<span></span>
<span><span class="co"># Visualize both the Atr and Ate matrices</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Atr</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Atr</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Train network"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/image.html" class="external-link">image</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Ate</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">Ate</span><span class="op">)</span><span class="op">:</span><span class="fl">1</span>,<span class="op">]</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Test network"</span><span class="op">)</span></span></code></pre></div>
<p><img src="network-inference-vignette_files/figure-html/unnamed-chunk-18-1.png" width="576"></p>
<p>Now, let us conduct community estimation using <code>Atr</code> using
<span class="math inline">K=2</span> communities.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Importantly, note that nett:spec_clust wants your matrix to be symmetric,</span></span>
<span><span class="co"># not just upper triangular.</span></span>
<span><span class="va">Atr_symm</span> <span class="op">&lt;-</span> <span class="va">Atr</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Atr</span><span class="op">)</span></span>
<span><span class="va">estimated_communities</span> <span class="op">&lt;-</span> <span class="fu">nett</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/nett/man/spec_clust.html" class="external-link">spec_clust</a></span><span class="op">(</span><span class="va">Atr_symm</span>, K <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">estimated_communities</span> <span class="co"># A vector specifying each node's estimated community</span></span>
<span><span class="co">#&gt;  [1] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 2</span></span>
<span><span class="co">#&gt; [39] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span></span></code></pre></div>
<p>Let’s conduct inference for the <strong>difference between the
connectivity within the estimated communities and the connectivity
between the communities.</strong> To do this, we will want to set an
appropriate linear combination vector <span class="math inline">u</span>
which is of length <span class="math inline">K^2</span>, where <span class="math inline">K</span> is the number of estimated communities.
Because our network is undirected, <span class="math inline">u</span>
<strong>must be upper triangular.</strong></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Note that matrix(u_vector, nrow = 2) would be upper triangular!</span></span>
<span><span class="va">u_vector</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Normalize it</span></span>
<span><span class="va">u_vector</span> <span class="op">&lt;-</span> <span class="va">u_vector</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">u_vector</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Conduct inference for the selected target (mean connectivity within the</span></span>
<span><span class="co"># first estimated community)</span></span>
<span><span class="va">poisson_inference</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="../reference/infer_network.html">infer_network</a></span><span class="op">(</span>Ate <span class="op">=</span> <span class="va">Ate</span>, u <span class="op">=</span> <span class="va">u_vector</span>,</span>
<span>                communities <span class="op">=</span> <span class="va">estimated_communities</span>,</span>
<span>                distribution <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>                epsilon <span class="op">=</span> <span class="fl">0.5</span>, is_directed <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                allow_self_loops <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s create a 90% confidence interval for the selected
parameter.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">0.10</span></span>
<span><span class="va">margin_of_error</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">alpha</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">poisson_inference</span><span class="op">$</span><span class="va">estimate_variance</span><span class="op">)</span></span>
<span><span class="va">ci_lower_bound</span> <span class="op">&lt;-</span> <span class="va">poisson_inference</span><span class="op">$</span><span class="va">estimate</span> <span class="op">-</span> <span class="va">margin_of_error</span></span>
<span><span class="va">ci_upper_bound</span> <span class="op">&lt;-</span> <span class="va">poisson_inference</span><span class="op">$</span><span class="va">estimate</span> <span class="op">+</span> <span class="va">margin_of_error</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Confidence interval for selected target is ["</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ci_lower_bound</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">", "</span>, <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">ci_upper_bound</span>, <span class="fl">4</span><span class="op">)</span>, <span class="st">"]"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Confidence interval for selected target is [5.7415, 6.4455]"</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ethan Ancell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
